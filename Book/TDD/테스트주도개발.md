## 참고

- [테스트주도개발 | 켄트백](http://www.yes24.com/Product/Goods/12246033)



## 목표

- 필요한부분을 정리하고,
- 실제 코드로 써보고, (Java, Python..)
- 챕터별로 끝날때 마다 처음부터 다시 본다.



## 1부

> 화폐예제



### 1장

- TDD 단계
  1. 테스트 하나 추가
  2. 모든 테스트를 실행하고, 새로 추가한것이 실패하는 지 확인
  3. 이에 따라 코드 조금 수정
  4. 모든 테스트 실행, 전부 성공을 확인
  5. **리팩토링** 을 통해 중복 제거



- 리팩토링?
  - 코드의 외적행위는 그대로 유지하면서, 내부구조를 변경하는 작업을 의미.



```java
package com.study.tdd.money;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
public class DollarTest {

	class Dollar {

		int amount;

		public Dollar(int amount) {
			this.amount = amount;
		}

		void times(int multiplier) {
			amount *= multiplier;
		}
	}

	@Test
	public void TestMultipiaction() {
		Dollar five = new Dollar(5);
		five.times(2);
		assertEquals(10, five.amount);
	}

}
```

- 먼저 테스트를 작성한다음에,
- 컴파일만 통과하도록 필요한 것들을 정의하고,
- 중복을 제거하여 코드를 깔끔하게 만든다.



### 2장

- 다시한번 TDD주기는
  1. 테스트를 작성하고
  2. 일단 통과하게 만들고
  3. 그런 다음에 올바르게 만든다.



- 1장 테스트에서 문제는 `int amount` 연산 수행후 매번 바뀌는 것. 안정적이지 못함.

```java
package com.study.tdd.money;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestInstance;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
public class DollarTest {

	class Dollar {

		int amount;

		public Dollar(int amount) {
			this.amount = amount;
		}

		Dollar times(int multiplier) {
			return new Dollar(amount * multiplier);
		}
	}

	@Test
	public void TestMultipiaction() {
		Dollar five = new Dollar(5);
		Dollar product = five.times(2);

		assertEquals(10, product.amount);
		product = five.times(3);
		assertEquals(15, product.amount);
	}

}
```

- 빠른 테스트 통과를 위한 방법?

  1. 상수를 이용한다.
     - 상수를 이용해서 우선 통과하게 만들고, 점진적으로 변수로 바꿔나감.
  2. 명백한 구현을 이용.
     - 실제 구현을 입력.. (아직 무슨말인지 이해안됨)

  

### 3장

- Value Object Pattern
  - 값 객체 패턴
  - 객체를 값처럼 쓸 수 있는 것.
  - 제약사항 : 객체의 인스턴스 변수가 생성자를 통해 일단 설정되면 결코 변하지 않아야 한다.

- 5$ 짜리 Dollar 객체가 있으면, **반드시 영원히** 보장받아야함.



```java
package com.study.tdd.money;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestInstance;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
public class DollarTest {

	class Dollar {

		int amount;

		public Dollar(int amount) {
			this.amount = amount;
		}

		Dollar times(int multiplier) {
			return new Dollar(amount * multiplier);
		}

		// 테스트 통과를 위해 가짜로 구현하는 방법 
		public boolean equals(Object object) {
			return true;
		}

	}

	@Test
	public void testEquality() {
		assertTrue(new Dollar(5).equals(new Dollar(5)));
	}
}
```

- `equals` 메서드를 정의해놓지 않으면, false가 나옴

- 그렇지만 `$5 == $5` 라는 사실